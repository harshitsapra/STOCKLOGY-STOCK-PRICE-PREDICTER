import yfinance as yf
import sqlite3

# Connect to a SQLite database
conn = sqlite3.connect('nifty50.db')
cursor = conn.cursor()

# Create a table to store the stock data
cursor.execute('''
    CREATE TABLE IF NOT EXISTS stocks (
        symbol TEXT,
        date DATE,
        open REAL,
        high REAL,
        low REAL,
        close REAL,
        volume INTEGER,
        dividends REAL,
        stock_splits INTEGER
    )
''')

# Define a list of Nifty 50 stock symbols
nifty50 = ['ADANIPORTS.NS', 'ASIANPAINT.NS', 'AXISBANK.NS', 'BAJAJ-AUTO.NS',
           'BAJFINANCE.NS', 'BAJAJFINSV.NS', 'BHARTIARTL.NS', 'BPCL.NS',
           'BRITANNIA.NS', 'CIPLA.NS', 'COALINDIA.NS', 'DIVISLAB.NS',
           'DRREDDY.NS', 'EICHERMOT.NS', 'GRASIM.NS', 'HCLTECH.NS', 'HDFC.NS',
           'HDFCBANK.NS', 'HDFCLIFE.NS', 'HEROMOTOCO.NS', 'HINDALCO.NS',
           'HINDUNILVR.NS', 'ICICIBANK.NS', 'INDUSINDBK.NS', 'INFY.NS',
           'IOC.NS', 'ITC.NS', 'JSWSTEEL.NS', 'KOTAKBANK.NS', 'LT.NS',
           'M&M.NS', 'MARUTI.NS', 'NESTLEIND.NS', 'NTPC.NS', 'ONGC.NS',
           'POWERGRID.NS', 'RELIANCE.NS', 'SBILIFE.NS', 'SBIN.NS', 'SHREECEM.NS',
           'SUNPHARMA.NS', 'TATAMOTORS.NS', 'TATASTEEL.NS', 'TCS.NS', 'TECHM.NS',
           'TITAN.NS', 'ULTRACEMCO.NS', 'UPL.NS', 'WIPRO.NS']

# Retrieve stock data for each symbol and insert it into the database
for symbol in nifty50:
    stock = yf.Ticker(symbol)
    data = stock.history(period='1d', start='2015-01-01', end='2023-03-03')
    data['Symbol'] = symbol
    data.reset_index(inplace=True)
    data.rename(columns={'Date': 'date', 'Open': 'open', 'High': 'high',
                          'Low': 'low', 'Close': 'close', 'Volume': 'volume',
                          'Dividends': 'dividends', 'Stock Splits': 'stock_splits',
                          'Symbol': 'symbol'}, inplace=True)
    data.to_sql('stocks', conn, if_exists='append', index=False)

# Close the database connection
conn.close()